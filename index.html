<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <base target="_top" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç­æœŸæœªé»åè·‘é¦¬ç‡ˆ</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: "Microsoft JhengHei", Arial, sans-serif;
        background: white;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        gap: 20px;
      }

      .marquee-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 95%;
        max-width: 1200px;
        margin: 0 auto;
        gap: 20px;
      }

      .title-marquee-wrapper {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        gap: 20px;
      }

      h1 {
        font-size: 28px;
        color: #333;
        margin: 0;
        white-space: nowrap;
        flex-shrink: 0;
        min-width: 120px;
      }

      .marquee-container {
        flex-grow: 1;
        height: 60px;
        border: 2px solid #333;
        border-radius: 8px;
        overflow: hidden;
        background: #f9f9f9;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        box-sizing: border-box;
      }

      .marquee {
        display: inline-block;
        white-space: nowrap;
        font-size: 28px;
        color: #000;
        padding-left: 100%;
        animation-timing-function: linear;
        animation-iteration-count: 1;
        will-change: transform;
      }

      @keyframes marquee {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
      }

      .page-info {
        margin-top: 10px;
        font-size: 18px;
        color: #555;
      }

      .controls {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .controls button,
      .controls input {
        padding: 8px 16px;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: #fff;
      }

      .controls button:hover {
        background: #eee;
      }

      .fullscreen-button {
        background: #f0f0f0;
      }

      input[type="number"] {
        width: 80px;
        text-align: center;
      }

      .list-container {
        display: flex;
        justify-content: space-between;
        width: 95%;
        max-width: 1200px;
        gap: 20px;
        margin-top: 20px;
      }

      .list-area {
        flex: 1;
        text-align: left;
        background: #fafafa;
        border-radius: 6px;
        border: 1px solid #ccc;
        padding: 15px;
        min-height: 100px;
      }

      .list-content span {
        display: inline-block;
        margin-right: 5px;
        font-size: 16px;
        color: #333;
        line-height: 1.8;
      }

      .loading-overlay {
        position: fixed;
        top: 10px;
        left: 10px;
        font-size: 12px;
        background: rgba(0,0,0,0.1);
        padding: 4px 8px;
        border-radius: 4px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="loading" class="loading-overlay">åŒæ­¥ä¸­...</div>

    <div class="marquee-wrapper">
      <div class="title-marquee-wrapper">
        <h1 id="pageTitle1">æœªé»å</h1>
        <div class="marquee-container">
          <div id="marquee1" class="marquee">è¼‰å…¥è³‡æ–™ä¸­...</div>
        </div>
      </div>
      <div class="title-marquee-wrapper">
        <h1 id="pageTitle2">å·²é»å</h1>
        <div class="marquee-container">
          <div id="marquee2" class="marquee">è¼‰å…¥è³‡æ–™ä¸­...</div>
        </div>
      </div>
    </div>

    <div class="page-info">
      <div>
        <label for="durationInput1">è·‘é¦¬ç‡ˆ(ä¸Š)ç§’æ•¸ï¼š</label>
        <input type="number" id="durationInput1" min="10" max="300" step="1" />
        <button onclick="resetDuration(1)">é‡ç½®è‡ªå‹•</button>
      </div>
      <div style="margin-top: 10px;">
        <label for="durationInput2">è·‘é¦¬ç‡ˆ(ä¸‹)ç§’æ•¸ï¼š</label>
        <input type="number" id="durationInput2" min="10" max="300" step="1" />
        <button onclick="resetDuration(2)">é‡ç½®è‡ªå‹•</button>
      </div>
    </div>

    <div class="controls">
      <button type="button" onclick="fetchAllData()">ğŸ”„ æ‰‹å‹•æ›´æ–°</button>
      <button class="fullscreen-button" onclick="toggleFullscreen()">ğŸ–¥ï¸ å…¨è¢å¹•</button>
    </div>

    <div class="list-container">
      <div id="listArea1" class="list-area">
        <strong><span id="listTitle1">åå–®ä¸€</span>ï¼š</strong>
        <div id="listContent1" class="list-content"></div>
      </div>
      <div id="listArea2" class="list-area">
        <strong><span id="listTitle2">åå–®äºŒ</span>ï¼š</strong>
        <div id="listContent2" class="list-content"></div>
      </div>
    </div>

    <script>
      /**
       * é‡è¦ï¼šè«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨çš„ Google Apps Script éƒ¨ç½²ç¶²å€
       */
      const GAS_API_URL = "https://script.google.com/macros/s/AKfycbz_xrF9vh8zcpA7DE38Gu0xLpAT4k79YyBLtlGMjNZgNXI4VYcvFqlzx4pjY5V0eIuaDg/exec";

      let manualDuration1 = null;
      let manualDuration2 = null;

      const durationInput1 = document.getElementById("durationInput1");
      const durationInput2 = document.getElementById("durationInput2");
      const marquee1 = document.getElementById("marquee1");
      const marquee2 = document.getElementById("marquee2");
      const loading = document.getElementById("loading");

      /**
       * æ ¸å¿ƒæŠ“å–å‡½å¼ (ä½¿ç”¨ Fetch API)
       */
      async function fetchAllData() {
        loading.style.display = "block";
        try {
          // åŠ ä¸Šæ™‚é–“æˆ³é˜²æ­¢å¿«å–
          const response = await fetch(`${GAS_API_URL}?t=${Date.now()}`);
          const data = await response.json();
          
          updateMarqueeUI(1, data.marquee1);
          updateMarqueeUI(2, data.marquee2);
        } catch (error) {
          console.error("ç„¡æ³•å¾ Google å–å¾—è³‡æ–™:", error);
          document.getElementById("marquee1").textContent = "é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ GAS ç¶²å€èˆ‡æ¬Šé™è¨­å®š";
        } finally {
          loading.style.display = "none";
        }
      }

      /**
       * æ›´æ–° UI é¡¯ç¤ºèˆ‡å‹•ç•«è¨­å®š
       */
      function updateMarqueeUI(id, data) {
        const titleEl = document.getElementById(`pageTitle${id}`);
        const listTitleEl = document.getElementById(`listTitle${id}`);
        const listContentEl = document.getElementById(`listContent${id}`);
        const marqueeEl = document.getElementById(`marquee${id}`);
        const inputEl = document.getElementById(`durationInput${id}`);
        
        titleEl.textContent = data.title || (id === 1 ? "æœªé»å" : "å·²é»å");
        listTitleEl.textContent = data.title || (id === 1 ? "åå–®ä¸€" : "åå–®äºŒ");
        
        const items = data.items || [];
        const text = items.length > 0 ? " " + items.join(" ï½œ ") : "ç›®å‰æ²’æœ‰è³‡æ–™";
        
        // è¨ˆç®—æŒçºŒæ™‚é–“
        let duration;
        const manual = (id === 1) ? manualDuration1 : manualDuration2;
        if (manual !== null) {
          duration = manual;
        } else {
          // è‡ªå‹•ç®—ï¼šæ–‡å­—è¶Šé•·è·‘è¶Šä¹…ï¼ŒåŸºæœ¬ 10ç§’èµ·ï¼Œæ¯ 15 å­—å¢ 1 ç§’
          duration = Math.min(300, Math.max(10, text.length / 3));
        }
        inputEl.value = duration.toFixed(1);

        // é‡ç½®å‹•ç•«
        marqueeEl.style.animation = "none";
        void marqueeEl.offsetWidth; 
        marqueeEl.textContent = text;
        
        if (items.length > 0) {
          marqueeEl.style.animation = `marquee ${duration}s linear 1`;
        } else {
          marqueeEl.style.animation = "none";
        }
        
        listContentEl.innerHTML = items
          .map((item) => `<span>${item}ã€</span>`)
          .join("");
      }

      // ç•¶å‹•ç•«çµæŸï¼Œè‡ªå‹•æŠ“å–æœ€æ–°è³‡æ–™ï¼ˆå¯¦ç¾è‡ªå‹•å¾ªç’°åŒæ­¥ï¼‰
      marquee1.onanimationend = () => fetchAllData();
      marquee2.onanimationend = () => fetchAllData();

      // ç§’æ•¸è®Šæ›´äº‹ä»¶
      durationInput1.addEventListener("change", () => {
        manualDuration1 = parseFloat(durationInput1.value);
        fetchAllData();
      });

      durationInput2.addEventListener("change", () => {
        manualDuration2 = parseFloat(durationInput2.value);
        fetchAllData();
      });

      function resetDuration(id) {
        if (id === 1) manualDuration1 = null;
        else manualDuration2 = null;
        fetchAllData();
      }

      function toggleFullscreen() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(err => {
            console.log(`Error attempting to enable full-screen mode: ${err.message}`);
          });
        } else {
          document.exitFullscreen();
        }
      }

      // åˆå§‹åŒ–è¼‰å…¥
      window.onload = fetchAllData;
    </script>
  </body>
</html>
