const SPREADSHEET_ID = '16dXvKJiczhOiwiOZ-Vs0epCv79OQ2bhD2rfRrBhlNHs';
const SHEET_NAME = '工作表1';

/**
 * 當外部（如 GitHub）發出 GET 請求時執行
 * 這是為了克服跨網域 (CORS) 問題，讓靜態網頁能抓到資料
 */
function doGet(e) {
  const data = getAllMarqueeData();
  const output = JSON.stringify(data);
  
  return ContentService.createTextOutput(output)
    .setMimeType(ContentService.MimeType.JSON);
}

/**
 * 讀取資料邏輯 (與原版相同，但彙整回傳)
 */
function getMarqueeItemsByColumn(columnNumber) {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = ss.getSheetByName(SHEET_NAME);
    const lastRow = sheet.getLastRow();

    if (lastRow < 1) {
      return { title: "", items: [] };
    }

    const title = sheet.getRange(1, columnNumber).getValue();
    let items = [];
    if (lastRow >= 2) {
      const values = sheet.getRange(2, columnNumber, lastRow - 1, 1).getValues();
      items = values.flat().filter(String);
    }

    return { title, items };
  } catch (e) {
    return { title: "錯誤", items: [`無法讀取: ${e.toString()}`] };
  }
}

function getAllMarqueeData() {
  return {
    marquee1: getMarqueeItemsByColumn(1),
    marquee2: getMarqueeItemsByColumn(4)
  };
}
